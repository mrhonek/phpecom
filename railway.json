{
  "$schema": "https://railway.app/railway.schema.json",
  "services": {
    "backend": {
      "name": "phpecom-api",
      "path": "backend",
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "composer install --no-interaction --prefer-dist --optimize-autoloader"
      },
      "deploy": {
        "startCommand": "php artisan migrate --force && php artisan db:seed --force && php artisan serve --host=0.0.0.0 --port=$PORT",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "healthcheck": {
        "path": "/api/health",
        "interval": 10,
        "timeout": 5,
        "retries": 3
      }
    },
    "frontend": {
      "name": "phpecom-web",
      "path": "frontend",
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "npm install && npm run build"
      },
      "deploy": {
        "startCommand": "npm start -- --host 0.0.0.0 --port $PORT",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "envs": {
        "BACKEND_URL": {
          "fromService": {
            "name": "phpecom-api",
            "property": "RAILWAY_PUBLIC_DOMAIN"
          }
        }
      }
    }
  }
} 